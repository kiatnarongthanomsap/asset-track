-- ================================================================================
-- Migration Script: ลบข้อมูลทั้งหมดในตาราง assets และเตรียมสำหรับ import ใหม่
-- ================================================================================
-- 
-- คำเตือน: สคริปต์นี้จะลบข้อมูลทั้งหมดในตาราง assets และ audit_logs
-- กรุณาตรวจสอบและสำรองข้อมูลก่อนรันสคริปต์นี้
-- ================================================================================

-- ================================================================================
-- ขั้นตอนที่ 1: ลบข้อมูล audit_logs ที่เกี่ยวข้องกับ assets
-- ================================================================================

-- ลบ audit logs ทั้งหมด (เพราะอ้างอิงถึง asset_code)
DELETE FROM audit_logs;

-- หรือถ้าต้องการเก็บ audit logs ไว้ ให้ comment บรรทัดข้างบน
-- และใช้คำสั่งนี้แทน (ลบเฉพาะที่อ้างอิงถึง assets ที่จะถูกลบ)
-- DELETE FROM audit_logs WHERE asset_code IN (SELECT code FROM assets);

-- ================================================================================
-- ขั้นตอนที่ 2: ลบข้อมูลทั้งหมดในตาราง assets
-- ================================================================================

-- ลบข้อมูลทั้งหมดในตาราง assets
TRUNCATE TABLE assets RESTART IDENTITY CASCADE;

-- หรือถ้าต้องการลบแบบ DELETE (เก็บ sequence ไว้)
-- DELETE FROM assets;

-- ================================================================================
-- ขั้นตอนที่ 3: รีเซ็ต sequence (ถ้าใช้ SERIAL)
-- ================================================================================

-- รีเซ็ต sequence ให้เริ่มที่ 1
-- ALTER SEQUENCE assets_id_seq RESTART WITH 1;

-- ================================================================================
-- ขั้นตอนที่ 4: ตรวจสอบผลลัพธ์
-- ================================================================================

-- ตรวจสอบว่าตาราง assets ว่างเปล่าแล้ว
-- SELECT COUNT(*) as remaining_assets FROM assets;
-- ผลลัพธ์ควรเป็น 0

-- ตรวจสอบว่าตาราง audit_logs ว่างเปล่าแล้ว
-- SELECT COUNT(*) as remaining_logs FROM audit_logs;
-- ผลลัพธ์ควรเป็น 0

-- ================================================================================
-- หมายเหตุ
-- ================================================================================
-- 
-- หลังจากรันสคริปต์นี้แล้ว:
-- 1. ใช้ generate_inserts.py เพื่อสร้าง INSERT statements จากไฟล์ Excel
-- 2. รัน INSERT statements ที่สร้างได้ใน Supabase SQL Editor
-- 3. หรือใช้ Excel Import Modal ในแอปพลิเคชันเพื่อนำเข้าข้อมูลใหม่
-- 
-- ตัวอย่างการใช้งาน:
-- python3 generate_inserts.py insert_statements_supabase.sql
-- 
-- ================================================================================

